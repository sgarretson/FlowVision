# FlowVision Development Rules for GitHub Best Practices

## Core Development Principles

You are an expert development assistant for the FlowVision project. Always follow these rules to maintain clean, synchronized, and professional GitHub repository management.

## GitHub Workflow Requirements

### Branch Management
- **NEVER commit directly to main branch**
- **ALWAYS create feature branches** with descriptive names: `feature/description-of-work`
- **ALWAYS verify branch protection** is enabled before making changes
- **ALWAYS keep feature branches small and focused** (single feature/fix per branch)
- **ALWAYS delete merged feature branches** both locally and remotely

### Commit Standards
- **ALWAYS use conventional commit format**: `type(scope): description`
  - Types: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`
  - Examples: `feat(clusters): add view details modal`, `fix(auth): resolve login redirect issue`
- **ALWAYS test locally before committing**
- **ALWAYS run `npm test` and ensure it passes**
- **ALWAYS clear build cache** (`rm -rf .next`) if encountering React/build errors

### Pull Request Process
- **ALWAYS create PR for any code changes**
- **ALWAYS include descriptive PR title and description**
- **ALWAYS request review before merging**
- **ALWAYS ensure CI/CD checks pass before requesting review**
- **ALWAYS resolve merge conflicts locally, never in GitHub UI**
- **NEVER force push to shared branches**
- **NEVER bypass branch protection without explicit approval**

### Code Quality Gates
- **ALWAYS run linting**: `npm run lint` (fix issues before committing)
- **ALWAYS run tests**: `npm test` (must pass before pushing)
- **ALWAYS verify build**: `npm run build` (for production readiness)
- **ALWAYS check for TypeScript errors**: Address all `tsc` warnings
- **ALWAYS validate database schema changes** with `npx prisma validate`

## Pre-Commit Checklist

Before every commit, verify:
- [ ] Code changes are tested locally
- [ ] No console.log statements in production code
- [ ] No hardcoded values (use environment variables)
- [ ] All imports are properly typed
- [ ] No unused variables or imports
- [ ] Database queries use proper error handling
- [ ] API routes have proper authentication checks
- [ ] React components use proper key props in lists

## Sync Management

### Daily Sync Protocol
1. **Start of day**: `git pull origin main`
2. **Before creating branch**: Ensure main is up-to-date
3. **End of work**: Push feature branch and create PR
4. **Never leave uncommitted changes** in working directory

### Emergency Procedures
If you encounter:
- **React "Objects are not valid as React child"**: Clear build cache with `rm -rf .next`
- **Module not found errors**: Clear cache and restart dev server
- **GitHub sync issues**: Create new feature branch from latest main
- **CI/CD failures**: Fix issues locally, never bypass checks
- **Merge conflicts**: Resolve locally with `git rebase main`
- **TypeScript null/undefined errors**: Transform Prisma nulls to undefined using `?? undefined`
- **Stuck interactive rebase**: Remove `.git/*.swp` files and set `git config core.editor "cat"`
- **Merge conflict markers in files**: Manually resolve all `<<<<<<<`, `=======`, `>>>>>>>` markers

## Repository Hygiene

### File Management
- **ALWAYS add appropriate .gitignore entries** for build artifacts
- **NEVER commit**: `.next/`, `node_modules/`, `.env.local`, IDE files
- **ALWAYS commit**: Lock files (`package-lock.json`, `yarn.lock`)
- **ALWAYS use absolute paths** in tool configurations when possible

### Documentation
- **ALWAYS update README.md** for significant feature additions
- **ALWAYS document API changes** in relevant files
- **ALWAYS add JSDoc comments** for complex functions
- **ALWAYS update CHANGELOG.md** for releases

## Error Prevention Rules

### React/Next.js Specific
- **ALWAYS use TypeScript strict mode**
- **ALWAYS define interfaces** for component props and API responses
- **ALWAYS handle loading and error states** in components
- **ALWAYS use proper async/await patterns** in API routes
- **NEVER render objects directly** in JSX (use specific properties)

### Database/Prisma
- **ALWAYS use transactions** for multi-table operations
- **ALWAYS validate input** before database queries
- **ALWAYS handle Prisma errors** with try/catch blocks
- **ALWAYS test schema changes** with seed data
- **ALWAYS transform** database `null` to `undefined` for external APIs using `?? undefined`

### AI/LLM Integration
- **ALWAYS validate** AI service configuration before use (`isConfigured()`)
- **ALWAYS include** confidence scores for AI-generated content
- **ALWAYS provide** fallback when AI services are unavailable
- **ALWAYS sanitize** AI responses before database storage
- **ALWAYS track** AI usage and costs in audit logs
- **ALWAYS indicate** AI-generated content with clear attribution
- **NEVER expose** OpenAI API keys in client-side code
- **ALWAYS use null-safe operations** for optional AI fields (`|| []` fallbacks)
- **ALWAYS provide proper context** for AI recommendations (systems, processes, people)

### Security
- **ALWAYS validate user permissions** in API routes
- **ALWAYS sanitize user input** before database operations
- **ALWAYS use environment variables** for secrets
- **NEVER commit API keys or passwords**

## Tool Integration

### Required Commands
Before any PR:
```bash
# Clean build
rm -rf .next

# Run full validation
npm run lint
npm test
npm run build

# Database validation
npx prisma validate
npx prisma generate
```

### GitHub CLI Usage
- Use `gh pr create` for consistent PR creation
- Use `gh pr status` to check PR state
- Use `gh pr checks` to verify CI/CD status
- Use `gh issue list` to track open issues

## Memory Management

Remember these key project facts:
- Project uses Docker for development environment
- Prefer no icons/emojis in user-facing content
- Keep 'facebook-ad-campaign' and 'Google_PPC' folders local only
- Main branch requires PR workflow with reviews
- All major features need comprehensive testing
- Systems Enhancement is major release - use proper GitHub project management
- Always include addressedIssues in initiative queries to prevent undefined errors
- Use proper null checking for all optional array fields in frontend components

## Conflict Resolution Best Practices

### Merge Conflict Prevention
- **ALWAYS rebase** feature branches regularly with main
- **KEEP branches** small and focused (single responsibility)
- **COMMUNICATE** with team before large refactoring
- **TEST locally** before pushing any merge resolution

### When Conflicts Occur
1. **STOP** and assess the scope of conflicts
2. **BACKUP** current work with `git stash` if needed
3. **RESOLVE** conflicts in order: simple to complex
4. **TEST thoroughly** after each resolution
5. **COMMIT** with descriptive merge commit message
6. **VERIFY** CI/CD passes before requesting reviews

### Common Conflict Patterns
- **Import statements**: Usually safe to combine both imports
- **Function implementations**: Choose the more complete version
- **Configuration files**: Merge security and functionality features
- **Type definitions**: Combine interfaces, avoid duplicates

## Systems Enhancement Project Rules

### Feature Development Protocol
- **ALWAYS use GitHub Projects** for milestone and task tracking
- **ALWAYS create detailed issues** before starting development
- **ALWAYS link commits to issues** using `#issue-number` in commit messages
- **ALWAYS update project status** when moving between development phases
- **ALWAYS coordinate with team** before modifying shared components

### Database Schema Changes
- **ALWAYS create migration scripts** for schema changes
- **ALWAYS test migrations** with existing seed data
- **ALWAYS update TypeScript types** when schema changes
- **ALWAYS validate relationships** between new and existing entities
- **ALWAYS backup production data** before schema migrations

### API Design Standards
- **ALWAYS follow RESTful conventions** for new endpoints
- **ALWAYS include proper error responses** with status codes
- **ALWAYS validate request payloads** using Zod or similar
- **ALWAYS include response type definitions** in TypeScript
- **ALWAYS test API endpoints** with both valid and invalid data

## Enforcement

If any of these rules are violated:
1. **STOP current work**
2. **FIX the violation** immediately
3. **DOCUMENT the fix** in commit message
4. **REVIEW process** to prevent recurrence

These rules are mandatory for maintaining professional, scalable, and reliable development practices.